<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dark Angel - Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --wa-bg: #0b141a; --wa-panel: #111b21; --wa-sent: #005c4b; --wa-received: #202c33; --wa-input-bg: #2a3942; }
        body, html { font-family: sans-serif; background-color: #000; margin: 0; height: 100%; overflow: hidden; }
        .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; background-color: var(--wa-bg); margin: 0 auto; position: relative; }
        @media (min-width: 768px) { .app-container { max-width: 500px; border-left: 1px solid #222e35; border-right: 1px solid #222e35; } }
        #chat-content { flex: 1; overflow-y: auto; display: flex; flex-direction: column; padding: 12px; z-index: 10; }
        .bubble { max-width: 85%; padding: 8px 12px; font-size: 15px; margin-bottom: 8px; border-radius: 12px; position: relative; }
        .sent { background-color: var(--wa-sent); align-self: flex-end; color: #fff; border-bottom-right-radius: 2px; }
        .received { background-color: var(--wa-received); align-self: flex-start; color: #e9edef; border-bottom-left-radius: 2px; }
        .input-area { background-color: var(--wa-panel); padding: 10px; display: flex; align-items: center; gap: 8px; }
        .input-wrapper { background-color: var(--wa-input-bg); border-radius: 24px; flex: 1; display: flex; padding: 0 15px; }
        .send-btn { background-color: #00a884; width: 45px; height: 45px; border-radius: 50%; color: white; border: none; flex-shrink: 0; }
    </style>
</head>
<body>
    <div id="app" class="app-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAAKqeX0Aq0n4OzgilX-5Q1PPVoSiPXCIc",
            authDomain: "chat-geral-a3bba.firebaseapp.com",
            projectId: "chat-geral-a3bba",
            storageBucket: "chat-geral-a3bba.firebasestorage.app",
            messagingSenderId: "1007033326627",
            appId: "1:1007033326627:web:26f07d61a8f9ba1f642596"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let myUser = JSON.parse(localStorage.getItem('da_user')) || { name: "Agente_" + Math.floor(Math.random()*999) };

        async function init() {
            await signInAnonymously(auth);
            renderChat();
        }

        function renderChat() {
            document.getElementById('app').innerHTML = `
                <header class="p-4 bg-[#111b21] text-white font-bold border-b border-white/5">DARK ANGEL - GLOBAL</header>
                <div id="chat-content"></div>
                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" id="msg-in" placeholder="Mensagem" class="w-full bg-transparent border-none outline-none text-white py-3">
                    </div>
                    <button id="send-btn" class="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
                </div>`;

            const q = query(collection(db, "global_messages"), orderBy("timestamp", "asc"));
            onSnapshot(q, (snap) => {
                const box = document.getElementById('chat-content');
                box.innerHTML = '';
                snap.forEach(doc => {
                    const m = doc.data();
                    const isMe = m.uid === auth.currentUser.uid;
                    const div = document.createElement('div');
                    div.className = `bubble ${isMe ? 'sent' : 'received'}`;
                    div.innerHTML = `<div style="font-size:10px; color:#4ade80">${m.author}</div>${m.text}`;
                    box.appendChild(div);
                });
                box.scrollTop = box.scrollHeight;
            });

            const send = async () => {
                const input = document.getElementById('msg-in');
                if(!input.value.trim()) return;
                await addDoc(collection(db, "global_messages"), {
                    text: input.value,
                    uid: auth.currentUser.uid,
                    author: myUser.name,
                    timestamp: serverTimestamp()
                });
                input.value = '';
            };
            document.getElementById('send-btn').onclick = send;
            document.getElementById('msg-in').onkeypress = (e) => e.key === 'Enter' && send();
        }
        init();
    </script>
</body>
</html>
